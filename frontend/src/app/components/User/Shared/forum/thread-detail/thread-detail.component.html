<div class="back-button mb-4">
  <p-button
    [label]="threadDetails?.Forum?.name || 'Back to Forum'"
    icon="pi pi-arrow-left"
    class="p-button-text p-button-secondary"
    (onClick)="goBack()"
  ></p-button>
</div>

<div class="thread-detail-container">
  <!-- Thread Header Section -->
  <div class="thread-header surface-card p-4 shadow-3 border-round mb-5">
    <!-- Author Section -->
    <div class="flex align-items-center mb-3">
      <p-avatar
        [image]="threadDetails?.User.photo"
        size="large"
        shape="circle"
        class="mr-3"
      ></p-avatar>
      <div>
        <h2 class="text-xl font-bold text-primary">
          {{ threadDetails?.title }}
        </h2>
        <div class="text-sm text-secondary">
          Posted by {{ threadDetails?.User.firstname || "Anonymous" }} â€¢
          {{ threadDetails?.createdAt | date : "medium" }}
        </div>
      </div>
    </div>
    <p class="text-secondary text-lg line-height-3 mb-3">
      {{ threadDetails?.content }}
    </p>

    <!-- Conditional Image Display -->
    <div
      *ngIf="
        threadDetails?.attachmentUrls &&
        threadDetails?.attachmentUrls?.length > 0
      "
      class="mt-3 thread-image"
    >
      <p-galleria
        [value]="threadDetails.attachmentUrls"
        [containerStyle]="{ 'max-width': '100%' }"
        [numVisible]="5"
        [showThumbnails]="false"
        [showIndicators]="threadDetails.attachmentUrls?.length > 1"
        [circular]="true"
        [showItemNavigators]="true"
      >
        <ng-template pTemplate="item" let-item>
          <img
            [src]="getImageUrl(item)"
            alt="Thread Media"
            class="w-full border-round-lg cursor-pointer"
            style="object-fit: cover; max-height: 300px"
          />
        </ng-template>
        <ng-template pTemplate="thumbnail" let-item>
          <img
            [src]="getImageUrl(item)"
            [alt]="item"
            style="width: 60px; height: 40px; object-fit: cover"
          />
        </ng-template>
      </p-galleria>
    </div>
  </div>

  <!-- Posts Section -->
  <div class="posts-section">
    <h3 class="text-lg font-bold text-primary mb-4">Posts</h3>

    <div *ngIf="posts.length > 0; else noPosts">
      <div
        *ngFor="let post of posts"
        class="post-item surface-card p-4 shadow-1 border-round mb-4"
      >
        <div class="flex align-items-center mb-3">
          <p-avatar
            [image]="post.User?.photo"
            size="large"
            shape="circle"
            class="mr-3"
          ></p-avatar>
          <div>
            <span class="font-bold text-md">{{
              post.User?.firstname || "Anonymous"
            }}</span>
            <span class="text-sm text-secondary ml-2">{{
              post.createdAt | date : "medium"
            }}</span>
          </div>
        </div>
        <p class="text-secondary line-height-3 mb-3">{{ post.content }}</p>
        <div *ngIf="post.attachments" class="thread-image">
          <img
            [src]="getImageUrl(post.attachments)"
            alt="Post Attachment"
            preview="true"
            style="object-fit: cover; max-height: 300px"
          />
        </div>
      </div>
    </div>

    <ng-template #noPosts>
      <div class="text-center text-secondary">
        No posts yet. Be the first to contribute!
      </div>
    </ng-template>
  </div>

  <!-- New Post Form -->
  <div class="new-post-form surface-card p-4 shadow-3 border-round-lg mt-5">
    <h3 class="text-md font-bold text-primary mb-3">Add a Post</h3>
    <textarea
      [(ngModel)]="newPostContent"
      rows="4"
      class="new-post-textarea p-inputtext text-md p-3 border-round shadow-1 mb-3"
      placeholder="Write your post here..."
    ></textarea>
    <div class="flex align-items-center justify-content-between">
      <input
        type="file"
        accept="image/*"
        (change)="onImageUpload($event)"
        class="hidden"
        #imageInput
      />
      <p-button
        icon="pi pi-image"
        label="Attach Image"
        class="p-button-text"
        (onClick)="imageInput.click()"
      ></p-button>
      <p-button
        label="Post"
        icon="pi pi-send"
        class="p-button-raised p-button-primary"
        (onClick)="addPost()"
        [disabled]="!newPostContent.trim()"
      ></p-button>
    </div>
  </div>
</div>
